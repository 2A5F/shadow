{"version":3,"file":"shadow.mjs","sources":["src/shadow.tsx"],"sourcesContent":["import { defineComponent, h, ref, onBeforeMount, onMounted } from \"vue\";\r\nimport type { App, VNode } from \"vue\";\r\n\r\nexport function makeShadow(el: Element) {\r\n  return makeShadowRaw(el, el.childNodes);\r\n}\r\nexport function makeShadowRaw(rootEl: Element, childNodes: NodeList) {\r\n  try {\r\n    const fragment = document.createDocumentFragment();\r\n    for (const node of childNodes) {\r\n      fragment.appendChild(node);\r\n    }\r\n\r\n    const oldroot = rootEl.shadowRoot;\r\n    if (oldroot != null) {\r\n      console.error(\r\n        \"[shadow] Attach shadow multiple times\",\r\n        rootEl,\r\n        childNodes,\r\n        oldroot\r\n      );\r\n      return;\r\n    } else {\r\n      const shadowroot = rootEl.attachShadow({ mode: \"open\" });\r\n      shadowroot.appendChild(fragment);\r\n      return shadowroot;\r\n    }\r\n  } catch (e) {\r\n    console.error(\"[shadow] make shadow-root failed\", rootEl, childNodes);\r\n    console.error(e);\r\n  }\r\n}\r\n\r\n// function removeShadow(rootEl: Element): Element {\r\n//     const newroot = rootEl.cloneNode() as Element\r\n//     while (rootEl.hasChildNodes()) {\r\n//         newroot.appendChild(rootEl.firstChild!)\r\n//     }\r\n//     rootEl.parentElement!.replaceChild(newroot, rootEl)\r\n//     console.log('removeShadow', newroot)\r\n//     return newroot\r\n// }\r\n\r\nexport const ShadowRoot = asInstall(\r\n  defineComponent({\r\n    props: {\r\n      abstract: {\r\n        type: Boolean,\r\n        default: false,\r\n      },\r\n      static: {\r\n        type: Boolean,\r\n        default: false,\r\n      },\r\n      tag: {\r\n        type: String,\r\n        default: \"div\",\r\n      },\r\n      slotTag: {\r\n        type: String,\r\n        default: \"div\",\r\n      },\r\n      slotClass: {\r\n        type: String,\r\n      },\r\n      slotId: {\r\n        type: String,\r\n      },\r\n      style: {\r\n        type: String,\r\n      },\r\n    },\r\n    setup(props, { slots }) {\r\n      const abstract = ref(false);\r\n      const static_ = ref(false);\r\n\r\n      const el = ref<HTMLElement>();\r\n\r\n      onBeforeMount(() => {\r\n        abstract.value = props.abstract;\r\n        static_.value = props.static;\r\n      });\r\n\r\n      onMounted(() => {\r\n        if (abstract.value) {\r\n          makeShadowRaw(el.value!.parentElement!, el.value!.childNodes);\r\n        } else {\r\n          makeShadow(el.value!);\r\n        }\r\n      });\r\n\r\n      return (): VNode => (\r\n        <props.tag ref={el}>\r\n          {[\r\n            static_.value ? (\r\n              slots.default!()\r\n            ) : (\r\n              <props.slotTag id={props.slotId} class={props.slotClass}>\r\n                {props.style ? (\r\n                  <style type=\"text/css\">{props.style}</style>\r\n                ) : (\r\n                  \"\"\r\n                )}\r\n                {[slots.default!()]}\r\n              </props.slotTag>\r\n            ),\r\n          ]}\r\n        </props.tag>\r\n      );\r\n    },\r\n    install,\r\n  })\r\n);\r\n\r\nfunction asInstall<T>(obj: T): T & { install: typeof install } {\r\n  return obj as any;\r\n}\r\n\r\nexport function install(app: App) {\r\n  app.component(\"shadow-root\", ShadowRoot);\r\n\r\n  app.directive(\"shadow\", {\r\n    beforeMount(el: HTMLElement) {\r\n      makeShadow(el);\r\n    },\r\n  });\r\n}\r\n\r\nexport { ShadowRoot as shadow_root };\r\nexport default { ShadowRoot, shadow_root: ShadowRoot, install };\r\n"],"names":[],"mappings":"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"}