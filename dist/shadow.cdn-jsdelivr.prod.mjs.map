{"version":3,"file":"shadow.cdn-jsdelivr.prod.mjs","sources":["../src/shadow.tsx"],"sourcesContent":["import { defineComponent, h, ref, onBeforeMount, onMounted } from \"vue\";\r\nimport type { App, VNode } from \"vue\";\r\n\r\nexport function makeShadow(el: Element) {\r\n  return makeShadowRaw(el, el.childNodes);\r\n}\r\nexport function makeShadowRaw(rootEl: Element, childNodes: NodeList) {\r\n  try {\r\n    const fragment = document.createDocumentFragment();\r\n    for (const node of childNodes) {\r\n      fragment.appendChild(node);\r\n    }\r\n\r\n    const oldroot = rootEl.shadowRoot;\r\n    if (oldroot != null) {\r\n      console.error(\r\n        \"[shadow] Attach shadow multiple times\",\r\n        rootEl,\r\n        childNodes,\r\n        oldroot\r\n      );\r\n      return;\r\n    } else {\r\n      const shadowroot = rootEl.attachShadow({ mode: \"open\" });\r\n      shadowroot.appendChild(fragment);\r\n      return shadowroot;\r\n    }\r\n  } catch (e) {\r\n    console.error(\"[shadow] make shadow-root failed\", rootEl, childNodes);\r\n    console.error(e);\r\n  }\r\n}\r\n\r\n// function removeShadow(rootEl: Element): Element {\r\n//     const newroot = rootEl.cloneNode() as Element\r\n//     while (rootEl.hasChildNodes()) {\r\n//         newroot.appendChild(rootEl.firstChild!)\r\n//     }\r\n//     rootEl.parentElement!.replaceChild(newroot, rootEl)\r\n//     console.log('removeShadow', newroot)\r\n//     return newroot\r\n// }\r\n\r\nexport const ShadowRoot = asInstall(\r\n  defineComponent({\r\n    props: {\r\n      abstract: {\r\n        type: Boolean,\r\n        default: false,\r\n      },\r\n      static: {\r\n        type: Boolean,\r\n        default: false,\r\n      },\r\n      tag: {\r\n        type: String,\r\n        default: \"div\",\r\n      },\r\n      slotTag: {\r\n        type: String,\r\n        default: \"div\",\r\n      },\r\n      slotClass: {\r\n        type: String,\r\n      },\r\n      slotId: {\r\n        type: String,\r\n      },\r\n      style: {\r\n        type: String,\r\n      },\r\n    },\r\n    setup(props, { slots }) {\r\n      const abstract = ref(false);\r\n      const static_ = ref(false);\r\n\r\n      const el = ref<HTMLElement>();\r\n\r\n      onBeforeMount(() => {\r\n        abstract.value = props.abstract;\r\n        static_.value = props.static;\r\n      });\r\n\r\n      onMounted(() => {\r\n        if (abstract.value) {\r\n          makeShadowRaw(el.value!.parentElement!, el.value!.childNodes);\r\n        } else {\r\n          makeShadow(el.value!);\r\n        }\r\n      });\r\n\r\n      return (): VNode => (\r\n        <props.tag ref={el}>\r\n          {[\r\n            static_.value ? (\r\n              slots.default!()\r\n            ) : (\r\n              <props.slotTag id={props.slotId} class={props.slotClass}>\r\n                {props.style ? (\r\n                  <style type=\"text/css\">{props.style}</style>\r\n                ) : (\r\n                  \"\"\r\n                )}\r\n                {[slots.default!()]}\r\n              </props.slotTag>\r\n            ),\r\n          ]}\r\n        </props.tag>\r\n      );\r\n    },\r\n    install,\r\n  })\r\n);\r\n\r\nfunction asInstall<T>(obj: T): T & { install: typeof install } {\r\n  return obj as any;\r\n}\r\n\r\nexport function install(app: App) {\r\n  app.component(\"shadow-root\", ShadowRoot);\r\n\r\n  app.directive(\"shadow\", {\r\n    beforeMount(el: HTMLElement) {\r\n      makeShadow(el);\r\n    },\r\n  });\r\n}\r\n\r\nexport { ShadowRoot as shadow_root };\r\nexport default { ShadowRoot, shadow_root: ShadowRoot, install };\r\n"],"names":["makeShadow","el","makeShadowRaw","childNodes","rootEl","fragment","document","createDocumentFragment","node","appendChild","oldroot","shadowRoot","console","error","shadowroot","attachShadow","mode","e","ShadowRoot","defineComponent","props","abstract","type","Boolean","default","static","tag","String","slotTag","slotClass","slotId","style","[object Object]","slots","ref","static_","onBeforeMount","value","onMounted","parentElement","h","id","class","install","app","component","directive","shadow_root"],"mappings":"qKAGgBA,EAAWC,GACzB,OAAOC,EAAcD,EAAIA,EAAGE,qBAEdD,EAAcE,EAAiBD,GAC7C,IACE,MAAME,EAAWC,SAASC,yBAC1B,IAAK,MAAMC,KAAQL,EACjBE,EAASI,YAAYD,GAGvB,MAAME,EAAUN,EAAOO,WACvB,GAAe,MAAXD,EAOF,YANAE,QAAQC,MACN,wCACAT,EACAD,EACAO,GAGG,CACL,MAAMI,EAAaV,EAAOW,aAAa,CAAEC,KAAM,SAE/C,OADAF,EAAWL,YAAYJ,GAChBS,GAET,MAAOG,GACPL,QAAQC,MAAM,mCAAoCT,EAAQD,GAC1DS,QAAQC,MAAMI,UAcLC,EACXC,EAAgB,CACdC,MAAO,CACLC,SAAU,CACRC,KAAMC,QACNC,SAAS,GAEXC,OAAQ,CACNH,KAAMC,QACNC,SAAS,GAEXE,IAAK,CACHJ,KAAMK,OACNH,QAAS,OAEXI,QAAS,CACPN,KAAMK,OACNH,QAAS,OAEXK,UAAW,CACTP,KAAMK,QAERG,OAAQ,CACNR,KAAMK,QAERI,MAAO,CACLT,KAAMK,SAGVK,MAAMZ,GAAOa,MAAEA,IACb,MAAMZ,EAAWa,GAAI,GACfC,EAAUD,GAAI,GAEdjC,EAAKiC,IAeX,OAbAE,GAAc,KACZf,EAASgB,MAAQjB,EAAMC,SACvBc,EAAQE,MAAQjB,EAAMK,UAGxBa,GAAU,KACJjB,EAASgB,MACXnC,EAAcD,EAAGoC,MAAOE,cAAgBtC,EAAGoC,MAAOlC,YAElDH,EAAWC,EAAGoC,UAIX,IACLG,EAACpB,EAAMM,KAAIQ,IAAKjC,GACb,CACCkC,EAAQE,MACNJ,EAAMT,UAENgB,EAACpB,EAAMQ,SAAQa,GAAIrB,EAAMU,OAAQY,MAAOtB,EAAMS,WAC3CT,EAAMW,MACLS,WAAOlB,KAAK,YAAYF,EAAMW,UAI/B,CAACE,EAAMT,eAOpBmB,QAAAA,aAQYA,EAAQC,GACtBA,EAAIC,UAAU,cAAe3B,GAE7B0B,EAAIE,UAAU,SAAU,CACtBd,YAAY/B,GACVD,EAAWC,MAMjB,MAAe,CAAEiB,WAAAA,EAAY6B,YAAa7B,EAAYyB,QAAAA"}