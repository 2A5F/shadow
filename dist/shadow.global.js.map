{"version":3,"file":"shadow.global.js","sources":["../src/shadow.tsx"],"sourcesContent":["import { defineComponent, h, ref, onBeforeMount, onMounted } from 'vue'\r\nimport type { App, VNode } from 'vue'\r\n\r\nexport function makeShadow(el: Element) {\r\n    return makeShadowRaw(el, el.childNodes)\r\n}\r\nexport function makeShadowRaw(rootEl: Element, childNodes: NodeList) {\r\n    try {\r\n        const fragment = document.createDocumentFragment()\r\n        for (const node of childNodes) {\r\n            fragment.appendChild(node)\r\n        }\r\n\r\n        const oldroot = rootEl.shadowRoot\r\n        if (oldroot != null) {\r\n            console.error('[shadow] Attach shadow multiple times', rootEl, childNodes, oldroot)\r\n            return\r\n        } else {\r\n            const shadowroot = rootEl.attachShadow({ mode: 'open' })\r\n            shadowroot.appendChild(fragment)\r\n            return shadowroot\r\n        }\r\n    } catch (e) {\r\n        console.error('[shadow] make shadow-root failed', rootEl, childNodes)\r\n        console.error(e)\r\n    }\r\n}\r\n\r\n// function removeShadow(rootEl: Element): Element {\r\n//     const newroot = rootEl.cloneNode() as Element\r\n//     while (rootEl.hasChildNodes()) {\r\n//         newroot.appendChild(rootEl.firstChild!)\r\n//     }\r\n//     rootEl.parentElement!.replaceChild(newroot, rootEl)\r\n//     console.log('removeShadow', newroot)\r\n//     return newroot\r\n// }\r\n\r\nexport const ShadowRoot = asInstall(defineComponent({\r\n    props: {\r\n        abstract: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        static: {\r\n            type: Boolean,\r\n            default: false,\r\n        },\r\n        tag: {\r\n            type: String,\r\n            default: 'div',\r\n        },\r\n        slotTag: {\r\n            type: String,\r\n            default: 'div',\r\n        },\r\n        slotClass: {\r\n            type: String,\r\n        },\r\n        slotId: {\r\n            type: String\r\n        }\r\n    },\r\n    setup(props, { slots }) {\r\n        const abstract = ref(false)\r\n        const static_ = ref(false)\r\n\r\n        const el = ref<HTMLElement>()\r\n\r\n        onBeforeMount(() => {\r\n            abstract.value = props.abstract\r\n            static_.value = props.static\r\n        })\r\n\r\n        onMounted(() => {\r\n            if (abstract.value) {\r\n                makeShadowRaw(el.value!.parentElement!, el.value!.childNodes)\r\n            } else {\r\n                makeShadow(el.value!)\r\n            }\r\n        })\r\n\r\n        return (): VNode => <props.tag ref={el}>{[\r\n            static_.value ? slots.default!() : <props.slotTag id={props.slotId} class={props.slotClass}>\r\n                {[slots.default!()]}\r\n            </props.slotTag>\r\n        ]}</props.tag>\r\n    },\r\n    install,\r\n}))\r\n\r\nfunction asInstall<T>(obj: T): T & { install: typeof install } {\r\n    return obj as any\r\n}\r\n\r\nexport function install(app: App) {\r\n    app.component('shadow-root', ShadowRoot)\r\n\r\n    app.directive('shadow', {\r\n        beforeMount(el: HTMLElement) {\r\n            makeShadow(el)\r\n        }\r\n    })\r\n}\r\n\r\nexport { ShadowRoot as shadow_root }\r\nexport default { ShadowRoot, shadow_root: ShadowRoot, install }"],"names":["defineComponent","ref","onBeforeMount","onMounted","h"],"mappings":"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"}