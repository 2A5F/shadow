{"version":3,"file":"shadow.global.js","sources":["../src/shadow.tsx"],"sourcesContent":["import { defineComponent, h, ref, onBeforeMount, onMounted } from \"vue\";\r\nimport type { App, VNode } from \"vue\";\r\n\r\nexport function makeShadow(el: Element) {\r\n  return makeShadowRaw(el, el.childNodes);\r\n}\r\nexport function makeShadowRaw(rootEl: Element, childNodes: NodeList) {\r\n  try {\r\n    const fragment = document.createDocumentFragment();\r\n    for (const node of childNodes) {\r\n      fragment.appendChild(node);\r\n    }\r\n\r\n    const oldroot = rootEl.shadowRoot;\r\n    if (oldroot != null) {\r\n      console.error(\r\n        \"[shadow] Attach shadow multiple times\",\r\n        rootEl,\r\n        childNodes,\r\n        oldroot\r\n      );\r\n      return;\r\n    } else {\r\n      const shadowroot = rootEl.attachShadow({ mode: \"open\" });\r\n      shadowroot.appendChild(fragment);\r\n      return shadowroot;\r\n    }\r\n  } catch (e) {\r\n    console.error(\"[shadow] make shadow-root failed\", rootEl, childNodes);\r\n    console.error(e);\r\n  }\r\n}\r\n\r\n// function removeShadow(rootEl: Element): Element {\r\n//     const newroot = rootEl.cloneNode() as Element\r\n//     while (rootEl.hasChildNodes()) {\r\n//         newroot.appendChild(rootEl.firstChild!)\r\n//     }\r\n//     rootEl.parentElement!.replaceChild(newroot, rootEl)\r\n//     console.log('removeShadow', newroot)\r\n//     return newroot\r\n// }\r\n\r\nexport const ShadowRoot = asInstall(\r\n  defineComponent({\r\n    props: {\r\n      abstract: {\r\n        type: Boolean,\r\n        default: false,\r\n      },\r\n      static: {\r\n        type: Boolean,\r\n        default: false,\r\n      },\r\n      tag: {\r\n        type: String,\r\n        default: \"div\",\r\n      },\r\n      slotTag: {\r\n        type: String,\r\n        default: \"div\",\r\n      },\r\n      slotClass: {\r\n        type: String,\r\n      },\r\n      slotId: {\r\n        type: String,\r\n      },\r\n      injectedStyle: {\r\n        type: String,\r\n      },\r\n    },\r\n    setup(props, { slots }) {\r\n      const abstract = ref(false);\r\n      const static_ = ref(false);\r\n\r\n      const el = ref<HTMLElement>();\r\n\r\n      onBeforeMount(() => {\r\n        abstract.value = props.abstract;\r\n        static_.value = props.static;\r\n      });\r\n\r\n      onMounted(() => {\r\n        if (abstract.value) {\r\n          makeShadowRaw(el.value!.parentElement!, el.value!.childNodes);\r\n        } else {\r\n          makeShadow(el.value!);\r\n        }\r\n      });\r\n\r\n      return (): VNode => (\r\n        <props.tag ref={el}>\r\n          {[\r\n            static_.value ? (\r\n              slots.default!()\r\n            ) : (\r\n              <props.slotTag id={props.slotId} class={props.slotClass}>\r\n                {props.injectedStyle ? (\r\n                  <style type=\"text/css\">{props.injectedStyle}</style>\r\n                ) : (\r\n                  \"\"\r\n                )}\r\n                {[slots.default!()]}\r\n              </props.slotTag>\r\n            ),\r\n          ]}\r\n        </props.tag>\r\n      );\r\n    },\r\n    install,\r\n  })\r\n);\r\n\r\nfunction asInstall<T>(obj: T): T & { install: typeof install } {\r\n  return obj as any;\r\n}\r\n\r\nexport function install(app: App) {\r\n  app.component(\"shadow-root\", ShadowRoot);\r\n\r\n  app.directive(\"shadow\", {\r\n    beforeMount(el: HTMLElement) {\r\n      makeShadow(el);\r\n    },\r\n  });\r\n}\r\n\r\nexport { ShadowRoot as shadow_root };\r\nexport default { ShadowRoot, shadow_root: ShadowRoot, install };\r\n"],"names":["defineComponent","ref","onBeforeMount","onMounted","h"],"mappings":"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"}