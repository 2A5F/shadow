{"version":3,"file":"shadow.global.prod.js","sources":["../src/shadow.tsx"],"sourcesContent":["import { defineComponent, h, ref, onBeforeMount, onMounted } from 'vue'\r\nimport type { App, VNode } from 'vue'\r\n\r\nexport function makeShadow(el: Element) {\r\n    return makeShadowRaw(el, el.childNodes)\r\n}\r\nexport function makeShadowRaw(rootEl: Element, childNodes: NodeList) {\r\n    try {\r\n        const fragment = document.createDocumentFragment()\r\n        for (const node of childNodes) {\r\n            fragment.appendChild(node)\r\n        }\r\n\r\n        const oldroot = rootEl.shadowRoot\r\n        if (oldroot != null) {\r\n            console.error('[shadow] Attach shadow multiple times', rootEl, childNodes, oldroot)\r\n            return\r\n        } else {\r\n            const shadowroot = rootEl.attachShadow({ mode: 'open' })\r\n            shadowroot.appendChild(fragment)\r\n            return shadowroot\r\n        }\r\n    } catch (e) {\r\n        console.error('[shadow] make shadow-root failed', rootEl, childNodes)\r\n        console.error(e)\r\n    }\r\n}\r\n\r\n// function removeShadow(rootEl: Element): Element {\r\n//     const newroot = rootEl.cloneNode() as Element\r\n//     while (rootEl.hasChildNodes()) {\r\n//         newroot.appendChild(rootEl.firstChild!)\r\n//     }\r\n//     rootEl.parentElement!.replaceChild(newroot, rootEl)\r\n//     console.log('removeShadow', newroot)\r\n//     return newroot\r\n// }\r\n\r\nexport const ShadowRoot = asInstall(defineComponent({\r\n    props: {\r\n        abstract: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        static: {\r\n            type: Boolean,\r\n            default: false,\r\n        },\r\n        tag: {\r\n            type: String,\r\n            default: 'div',\r\n        },\r\n        slotTag: {\r\n            type: String,\r\n            default: 'div',\r\n        },\r\n        slotClass: {\r\n            type: String,\r\n        },\r\n        slotId: {\r\n            type: String\r\n        }\r\n    },\r\n    setup(props, { slots }) {\r\n        const abstract = ref(false)\r\n        const static_ = ref(false)\r\n\r\n        const el = ref<HTMLElement>()\r\n\r\n        onBeforeMount(() => {\r\n            abstract.value = props.abstract\r\n            static_.value = props.static\r\n        })\r\n\r\n        onMounted(() => {\r\n            if (abstract.value) {\r\n                makeShadowRaw(el.value!.parentElement!, el.value!.childNodes)\r\n            } else {\r\n                makeShadow(el.value!)\r\n            }\r\n        })\r\n\r\n        return (): VNode => <props.tag ref={el}>{[\r\n            static_.value ? slots.default!() : <props.slotTag id={props.slotId} class={props.slotClass}>\r\n                {[slots.default!()]}\r\n            </props.slotTag>\r\n        ]}</props.tag>\r\n    },\r\n    install,\r\n}))\r\n\r\nfunction asInstall<T>(obj: T): T & { install: typeof install } {\r\n    return obj as any\r\n}\r\n\r\nexport function install(app: App) {\r\n    app.component('shadow-root', ShadowRoot)\r\n\r\n    app.directive('shadow', {\r\n        beforeMount(el: HTMLElement) {\r\n            makeShadow(el)\r\n        }\r\n    })\r\n}\r\n\r\nexport { ShadowRoot as shadow_root }\r\nexport default { ShadowRoot, shadow_root: ShadowRoot, install }"],"names":["makeShadow","el","makeShadowRaw","childNodes","rootEl","fragment","document","createDocumentFragment","node","appendChild","oldroot","shadowRoot","console","error","shadowroot","attachShadow","mode","e","ShadowRoot","defineComponent","props","abstract","type","Boolean","default","static","tag","String","slotTag","slotClass","slotId","[object Object]","slots","ref","static_","onBeforeMount","value","onMounted","parentElement","h","id","class","install","app","component","directive","shadow_root"],"mappings":"oRAGgBA,EAAWC,GACvB,OAAOC,EAAcD,EAAIA,EAAGE,qBAEhBD,EAAcE,EAAiBD,GAC3C,IACI,MAAME,EAAWC,SAASC,yBAC1B,IAAK,MAAMC,KAAQL,EACfE,EAASI,YAAYD,GAGzB,MAAME,EAAUN,EAAOO,WACvB,GAAe,MAAXD,EAEA,YADAE,QAAQC,MAAM,wCAAyCT,EAAQD,EAAYO,GAExE,CACH,MAAMI,EAAaV,EAAOW,aAAa,CAAEC,KAAM,SAE/C,OADAF,EAAWL,YAAYJ,GAChBS,GAEb,MAAOG,GACLL,QAAQC,MAAM,mCAAoCT,EAAQD,GAC1DS,QAAQC,MAAMI,UAcTC,EAAuBC,kBAAgB,CAChDC,MAAO,CACHC,SAAU,CACNC,KAAMC,QACNC,SAAS,GAEbC,OAAQ,CACJH,KAAMC,QACNC,SAAS,GAEbE,IAAK,CACDJ,KAAMK,OACNH,QAAS,OAEbI,QAAS,CACLN,KAAMK,OACNH,QAAS,OAEbK,UAAW,CACPP,KAAMK,QAEVG,OAAQ,CACJR,KAAMK,SAGdI,MAAMX,GAAOY,MAAEA,IACX,MAAMX,EAAWY,OAAI,GACfC,EAAUD,OAAI,GAEdhC,EAAKgC,QAeX,OAbAE,iBAAc,KACVd,EAASe,MAAQhB,EAAMC,SACvBa,EAAQE,MAAQhB,EAAMK,UAG1BY,aAAU,KACFhB,EAASe,MACTlC,EAAcD,EAAGmC,MAAOE,cAAgBrC,EAAGmC,MAAOjC,YAElDH,EAAWC,EAAGmC,UAIf,IAAaG,IAACnB,EAAMM,KAAIO,IAAKhC,GAAK,CACrCiC,EAAQE,MAAQJ,EAAMR,UAAae,IAACnB,EAAMQ,SAAQY,GAAIpB,EAAMU,OAAQW,MAAOrB,EAAMS,WAC5E,CAACG,EAAMR,eAIpBkB,QAAAA,aAOYA,EAAQC,GACpBA,EAAIC,UAAU,cAAe1B,GAE7ByB,EAAIE,UAAU,SAAU,CACpBd,YAAY9B,GACRD,EAAWC,YAMR,CAAEiB,WAAAA,EAAY4B,YAAa5B,EAAYwB,QAAAA"}